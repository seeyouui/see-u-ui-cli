name: Sync SeeYouUI to CLI

on:
  push:
    branches: [main]

jobs:
  sync-code:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout 源仓库 see-u-ui
      - name: Checkout source (see-u-ui)
        uses: actions/checkout@v4
        with:
          path: source

      # 2️⃣ Checkout 目标仓库 see-u-ui-cli
      - name: Checkout target (see-u-ui-cli)
        uses: actions/checkout@v4
        with:
          repository: seeyouui/see-u-ui-cli
          token: ${{ secrets.SYNC_TOKEN }}
          path: target
          ref: main

      # 3️⃣ 删除 src/ 所有内容
      - name: Clean target/src
        run: |
          echo "清空 target/src/ ..."
          rm -rf target/src/*
          rm -rf target/src/.* 2>/dev/null || true
          echo "清空完成"

      # 4️⃣ 拷贝源仓库文件到 target/src
      - name: Copy all files
        run: |
          echo "开始拷贝源仓库文件..."
          cp -r source/* target/src/
          cp -r source/.* target/src/ 2>/dev/null || true
          echo "拷贝完成"

      # 5️⃣ 提交并推送
      - name: Commit and Push
        working-directory: target
        run: |
          git config user.name "GitHub Action Bot"
          git config user.email "action@github.com"

          git add .

          if git diff --staged --quiet; then
            echo "没有变化。"
            exit 0
          fi

          git commit -m "同步 see-u-ui $(date +'%Y-%m-%d %H:%M:%S')"
          git push origin main
          echo "推送成功！"
